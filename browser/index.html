<html>

<body>
    <p1>Example to use GMD SDK in browser.</p1>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="./dist/gmd-sdk.js"></script>
    <script>
        /**
         *  Example on how to genearate a wallet
         */
        GMD.generateAccount().then(data => console.log('Generated wallet ' + JSON.stringify(data, null, 2)));

        /**
         *  Example on how to genearate a wallet based on a passphrase
         */
        GMD.generateAccount('this is a passphrase example any numer of words is fine').then(data => console.log('Generated wallet with a provided passphrase: ${JSON.stringify(data, null, 2))}'));

        /**
         *  Example on how to set globally the URL of the GMD node. In this case we set it to testnet.
         *  It is also possible to specify a URL on a specific node
         *  My default main net node https://node.thecoopnetwork.io is used.
         *  
         */
        console.log("Setting url to testnet:");
        GMD.setURL('https://node.thecoopnetwork.io:6877');

        /**
         * Example on how to send on testnet 0.001 GMD to wallet GMD-43MP-76UW-L69N-ALW39.
         *          
         */
        console.log('Sending money to GMD-43MP-76UW-L69N-ALW39');
        GMD.sendMoney('GMD-43MP-76UW-L69N-ALW39', '100000', 'screen drawn leave power connect confidence liquid everytime wall either poet shook', '100000000')
            .then(console.log);

        /**
         * Example on how to call an api on the node. In this example we call a main net node to retrieve a list of accounts.
         * For a complete list of all API available on a node, please visit https://node.thecoopnetwork.io/test
         * To specify the node, use "baseURL".
         */
        paramsGetAccounts = {
            requestType: 'getAccountsBulk',
            pageSize: 3,
            page: 0,
            baseURL: 'https://node.thecoopnetwork.io'
        }
        GMD.apiCall('get', paramsGetAccounts).then((res) => {
            console.log('List of first 3 accounts: \n' + JSON.stringify(res, null, 2));
        });

        /**
        * Exemple on how to make transaction in 3 steps: create unsigned transaction, sign transaction, broadcast transaction. This is usefull when 
        * signing and broadcasting is performed on different devices.
        */
        GMD.createUnsignedSendMoneyTransaction('GMD-43MP-76UW-L69N-ALW39', '2000000', 'f72258e2be98b5047c0cb4ff667b48a100699bf175122027aafd4182835f3c2e', '100000000')
            .then(transaction => GMD.signTransaction(transaction.unsignedTransactionBytes, 'screen drawn leave power connect confidence liquid everytime wall either poet shook')
                .then(signedTransactionBytes => GMD.broadcastSignedTransaction(signedTransactionBytes).then(console.log)));

        /**
         * Example how to sign an arbitrary message with a private key.
         * In this example we generate a wallet, use the private key of that wallet to sign a an arbitrary message
         * and check the signature against the public key.
         */
        GMD.generateAccount().then(async wallet => {
            console.log(JSON.stringify(wallet, null, 2));
            let messageToSign = 'This is an arbitrary message example';
            let hexMessageToSign = GMD.util.strToHex(messageToSign);
            let signature = await GMD.signHexMessagePrivateKey(hexMessageToSign, wallet.privateKey);
            console.log('signature=' + signature);
            let ret = await GMD.verifySignature(signature, hexMessageToSign, wallet.publicKey);
            console.log("Signature verification result: " + ret);
            console.log('TestSignature finished.');
        });

        /**
         * Example how to encrypt private key, store the encrypted JSON in localStorage, retrieve it back from local storage and decrypt it.
         */
        (testEncryption = async () => {
            let wallet = await GMD.generateAccount();
            let encryptionPassword = 'Some password example 123&^%#*()%^@0=-'; //any UTF-8 char is permited in the password
            console.log('==encr== Generated wallet: ' + JSON.stringify(wallet, null, 2));
            let encryptedJSON;
            try {
                encryptedJSON = await GMD.util.encryptHex(wallet.privateKey, encryptionPassword);
            } catch (e) {
                console.log('==encr== Cannot encrypt: ' + e);
                return;
            }

            console.log('==encr== Encrypted JSON: ' + JSON.stringify(encryptedJSON, null, 2));
            let ciphertext_storage_key = 'gmd-sdk-encrypted-json';
            localStorage.setItem(ciphertext_storage_key, JSON.stringify(encryptedJSON));

            let encryptedJSONRetrievedFromStorage = JSON.parse(localStorage.getItem(ciphertext_storage_key));
            let privateKeyDecrypted;
            try {
                privateKeyDecrypted = await GMD.util.decryptToHex(encryptedJSONRetrievedFromStorage, encryptionPassword);
            } catch (e) {
                console.log('==encr== cannot decrypt: ' + e);
            }

            console.log('==encr== Private key decrypted: ' + privateKeyDecrypted);

        })();


    </script>
</body>

</html>